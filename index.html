<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุชุงุจุนุฉ ุงูุนุจุงุฏุงุช ุงูุนุงุฆููุฉ</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ูุงุฆูุฉ ุงููุตุงุฆุญ ูุงูุฃุญุงุฏูุซ
        const dailyTips = [
            "ูุงู ๏ทบ: 'ุฃุญุจ ุงูุฃุนูุงู ุฅูู ุงููู ุฃุฏูููุง ูุฅู ูู'.",
            "ูุตูุญุฉ: ุงุฌุนู ูููุณู ุฎุจูุฆุฉ ูู ุนูู ุตุงูุญ ูุง ูุนูููุง ุฅูุง ุงููู.",
            "ูุงู ๏ทบ: 'ูู ุณูู ุทุฑูููุง ููุชูุณ ููู ุนูููุง ุณูู ุงููู ูู ุจู ุทุฑูููุง ุฅูู ุงูุฌูุฉ'.",
            "ูุตูุญุฉ: ุงูุตูุงุฉ ุนูู ุงููุจู ๏ทบ ุชูุชุญ ุงูุฃุจูุงุจ ุงููุบููุฉ.",
            "ูุงู ๏ทบ: 'ุงูุฏุงู ุนูู ุงูุฎูุฑ ููุงุนูู'.",
            "ูุงู ๏ทบ: 'ูููุชุงู ุฎูููุชุงู ุนูู ุงููุณุงูุ ุซูููุชุงู ูู ุงูููุฒุงู: ุณุจุญุงู ุงููู ูุจุญูุฏูุ ุณุจุญุงู ุงููู ุงูุนุธูู'.",
            "ูุตูุญุฉ: ุณูุฑุฉ ุงูููู ูู ุงูููุฌูุฉ ูู ุนุฐุงุจ ุงููุจุฑุ ุญุงูุธ ุนูููุง ูุจู ูููู."
        ];

        function App() {
            const users = ['ูุญูุฏ', 'ุดููุงุก', 'ุฃุญูุฏ', 'ูุงุณูู'];
            const getTodayStr = () => new Date().toISOString().split('T')[0];
            const [selectedDate, setSelectedDate] = useState(getTodayStr());
            const [data, setData] = useState(() => JSON.parse(localStorage.getItem('worship_final_db') || '{}'));

            useEffect(() => {
                localStorage.setItem('worship_final_db', JSON.stringify(data));
            }, [data]);

            const isFriday = new Date(selectedDate).getDay() === 5;

            // ุจูุงุก ูุงุฆูุฉ ุงูุนุจุงุฏุงุช ุจูุงุกู ุนูู ุทูุจู
            const tasks = useMemo(() => {
                let t = [
                    "ุณูุฉ ุงููุฌุฑ", 
                    "ุตูุงุฉ ุงููุฌุฑ", 
                    "ุฃุฐูุงุฑ ุงูุตุจุงุญ", 
                    "ุงูุถุญู",
                    "ูค ุฑูุนุงุช ูุจู ุงูุธูุฑ", 
                    isFriday ? "ุตูุงุฉ ุงูุฌูุนุฉ" : "ุตูุงุฉ ุงูุธูุฑ", 
                    "ุฑูุนุชุงู ุจุนุฏ ุงูุธูุฑ",
                    "ุตูุงุฉ ุงูุนุตุฑ", 
                    "ุฃุฐูุงุฑ ุงููุณุงุก", 
                    "ุตูุงุฉ ุงููุบุฑุจ", 
                    "ุฑูุนุชุงู ุจุนุฏ ุงููุบุฑุจ",
                    "ุตูุงุฉ ุงูุนุดุงุก", 
                    "ุฑูุนุชุงู ุจุนุฏ ุงูุนุดุงุก", 
                    "ุณูุฑุฉ ุงูููู", 
                    "ุงูุดูุน ูุงููุชุฑ", 
                    "ุงูููุงู", 
                    "ุงููุฑุฏ ุงููุฑุขูู", 
                    "ุฃุฐูุงุฑ ุงูููู"
                ];
                // ุฅุถุงูุฉ ุณูุฑุฉ ุงูููู ููู ุงูุฌูุนุฉ ููุท
                if (isFriday) {
                    t.splice(4, 0, "ุณูุฑุฉ ุงูููู ๐");
                }
                return t;
            }, [isFriday]);

            const toggle = (user, task) => {
                const newData = { ...data };
                if (!newData[selectedDate]) newData[selectedDate] = {};
                if (!newData[selectedDate][user]) newData[selectedDate][user] = {};
                newData[selectedDate][user][task] = !newData[selectedDate][user][task];
                setData(newData);
            };

            // ุญุณุงุจ ุงูุฅูุฌุงุฒุงุช ููุชุฑุชูุจ
            const scores = users.map(user => {
                const completed = data[selectedDate]?.[user] ? Object.values(data[selectedDate][user]).filter(Boolean).length : 0;
                return { name: user, count: completed };
            }).sort((a, b) => b.count - a.count);

            const todayTip = dailyTips[new Date(selectedDate).getDate() % dailyTips.length];

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col pb-10 border-x border-slate-200">
                    {/* ุฑุฃุณ ุงูุตูุญุฉ */}
                    <div className={`${isFriday ? 'bg-emerald-700' : 'bg-blue-700'} p-5 text-white shadow-lg`}>
                        <h1 className="text-xl font-bold text-center mb-4">ุญุตุงุฏ ุงูุนุจุงุฏุงุช ุงูุนุงุฆูู</h1>
                        <div className="bg-white/10 p-3 rounded-xl">
                            <input 
                                type="date" 
                                value={selectedDate} 
                                onChange={(e) => setSelectedDate(e.target.value)}
                                className="w-full text-slate-900 p-2 rounded font-bold"
                            />
                        </div>
                    </div>

                    {/* ูุตูุญุฉ ุงูููู */}
                    <div className="m-4 p-4 bg-amber-50 border-r-4 border-amber-500 rounded-sm">
                        <p className="text-sm text-amber-900 font-medium">๐ก {todayTip}</p>
                    </div>

                    {/* ุฌุฏูู ุงูุนุจุงุฏุงุช */}
                    <div className="overflow-x-auto">
                        <table className="w-full text-right">
                            <thead className="bg-slate-100">
                                <tr>
                                    <th className="p-3 text-xs text-slate-500">ุงูุนุจุงุฏุฉ</th>
                                    {users.map(u => <th key={u} className="p-1 text-center text-[10px] text-slate-400 font-bold">{u}</th>)}
                                </tr>
                            </thead>
                            <tbody>
                                {tasks.map((t, i) => (
                                    <tr key={t} className={`border-b border-slate-50 ${i % 2 === 0 ? 'bg-white' : 'bg-slate-50/50'}`}>
                                        <td className={`p-3 text-sm font-medium ${t.includes('ุงูููู') ? 'text-emerald-600' : 'text-slate-700'}`}>{t}</td>
                                        {users.map(u => (
                                            <td key={u} className="text-center p-1">
                                                <button onClick={() => toggle(u, t)} className="text-2xl hover:scale-110 transition-transform">
                                                    {data[selectedDate]?.[u]?.[t] ? 'โ' : 'โช'}
                                                </button>
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* ููุญุฉ ุงูุตุฏุงุฑุฉ (Leaderboard) */}
                    <div className="m-4 mt-8 bg-slate-100 p-4 rounded-2xl">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2">๐ ุชุฑุชูุจ ุงูุฅูุฌุงุฒ ุงููููู</h2>
                        <div className="space-y-2">
                            {scores.map((s, idx) => (
                                <div key={s.name} className={`flex justify-between items-center p-3 rounded-lg ${idx === 0 && s.count > 0 ? 'bg-emerald-100 border border-emerald-200' : 'bg-white'}`}>
                                    <div className="flex items-center gap-3">
                                        <span className="font-bold text-slate-400">#{idx + 1}</span>
                                        <span className="font-bold">{s.name}</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-sm bg-slate-200 px-2 py-0.5 rounded text-slate-600">{s.count}</span>
                                        {idx === 0 && s.count > 0 && <span className="text-xs font-bold text-emerald-600 animate-pulse">ูุฌู ุงูููู โญ</span>}
                                    </div>
                                </div>
                            ))}
                        </div>
                        {scores[0].count > 0 && (
                            <div className="mt-4 p-3 bg-white rounded-lg border-2 border-dashed border-emerald-300 text-center">
                                <p className="text-emerald-700 font-bold text-sm italic">
                                    "ุฃุญุณูุช ูุง {scores[0].name}ุ ุฃูุช ูุฏูุฉ ููุง ุงูููู! ุงุณุชูุฑ ๐"
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
