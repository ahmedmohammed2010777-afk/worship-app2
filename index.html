<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุชุงุจุนุฉ ุงูุนุจุงุฏุงุช ุงูุนุงุฆููุฉ ุงููุดุชุฑูุฉ</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ุงูุฑุงุจุท ุงูุณุญุงุจู (ูุฐุง ุงููุฎุฒู ูุดุชุฑู ููุฌููุน)
        const DB_URL = "https://api.jsonbin.io/v3/b/65ae36f1dc74654018979607"; 
        const API_KEY = "$2a$10$X8A2V7p6lU6LhF3X3.J3AeX0yG7L2fP5C2uR7O5G8o7U6i5Y4z5C"; // ุชุฌุฑูุจู

        function App() {
            const users = ['ูุญูุฏ', 'ุดููุงุก', 'ุฃุญูุฏ', 'ูุงุณูู'];
            const getTodayStr = () => new Date().toISOString().split('T')[0];
            const [selectedDate, setSelectedDate] = useState(getTodayStr());
            const [data, setData] = useState({});
            const [loading, setLoading] = useState(true);

            // 1. ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุฅูุชุฑูุช ุนูุฏ ูุชุญ ุงูุชุทุจูู
            useEffect(() => {
                fetchData();
                // ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ ูุฑุคูุฉ ุชุบููุฑุงุช ุงูุขุฎุฑูู
                const interval = setInterval(fetchData, 30000);
                return () => clearInterval(interval);
            }, []);

            const fetchData = async () => {
                try {
                    const res = await fetch('https://api.myjson.online/v1/records/063f972b-8716-436d-9781-9b63a9484b3d');
                    const json = await res.json();
                    setData(json.data || {});
                    setLoading(false);
                } catch (e) { console.error("ุฎุทุฃ ูู ุงูุฌูุจ"); setLoading(false); }
            };

            // 2. ุญูุธ ุงูุจูุงูุงุช ุนูู ุงูุฅูุชุฑูุช ููุฑ ุงูุชุบููุฑ
            const saveData = async (newData) => {
                try {
                    await fetch('https://api.myjson.online/v1/records/063f972b-8716-436d-9781-9b63a9484b3d', {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ data: newData })
                    });
                } catch (e) { alert("ูุดู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช!"); }
            };

            const isFriday = new Date(selectedDate).getDay() === 5;
            const tasks = useMemo(() => {
                let t = ["ุณูุฉ ุงููุฌุฑ", "ุตูุงุฉ ุงููุฌุฑ", "ุฃุฐูุงุฑ ุงูุตุจุงุญ", "ุงูุถุญู", "ูค ุฑูุนุงุช ูุจู ุงูุธูุฑ", isFriday ? "ุตูุงุฉ ุงูุฌูุนุฉ" : "ุตูุงุฉ ุงูุธูุฑ", "ุฑูุนุชุงู ุจุนุฏ ุงูุธูุฑ", "ุตูุงุฉ ุงูุนุตุฑ", "ุฃุฐูุงุฑ ุงููุณุงุก", "ุตูุงุฉ ุงููุบุฑุจ", "ุฑูุนุชุงู ุจุนุฏ ุงููุบุฑุจ", "ุตูุงุฉ ุงูุนุดุงุก", "ุฑูุนุชุงู ุจุนุฏ ุงูุนุดุงุก", "ุณูุฑุฉ ุงูููู", "ุงูุดูุน ูุงููุชุฑ", "ุงูููุงู", "ุงููุฑุฏ ุงููุฑุขูู", "ุฃุฐูุงุฑ ุงูููู"];
                if (isFriday) t.splice(4, 0, "ุณูุฑุฉ ุงูููู ๐");
                return t;
            }, [isFriday]);

            const toggle = (user, task) => {
                const newData = { ...data };
                if (!newData[selectedDate]) newData[selectedDate] = {};
                if (!newData[selectedDate][user]) newData[selectedDate][user] = {};
                newData[selectedDate][user][task] = !newData[selectedDate][user][task];
                setData(newData);
                saveData(newData); // ุฑูุน ุงูุชุบููุฑ ููุฑุงู
            };

            const scores = users.map(user => {
                const completed = data[selectedDate]?.[user] ? Object.values(data[selectedDate][user]).filter(Boolean).length : 0;
                return { name: user, count: completed };
            }).sort((a, b) => b.count - a.count);

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col pb-10">
                    <div className={`${isFriday ? 'bg-emerald-700' : 'bg-blue-700'} p-5 text-white`}>
                        <h1 className="text-xl font-bold text-center mb-4">ุญุตุงุฏ ุงูุนุจุงุฏุงุช ุงูุนุงุฆูู (ูุจุงุดุฑ)</h1>
                        {loading && <p className="text-center text-xs animate-pulse mb-2">ุฌุงุฑู ุงููุฒุงููุฉ...</p>}
                        <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="w-full text-slate-900 p-2 rounded font-bold" />
                    </div>

                    <div className="overflow-x-auto flex-grow px-2">
                        <table className="w-full text-right">
                            <thead>
                                <tr className="border-b text-[10px] text-slate-400">
                                    <th className="p-3">ุงูุนุจุงุฏุฉ</th>
                                    {users.map(u => <th key={u} className="text-center">{u}</th>)}
                                </tr>
                            </thead>
                            <tbody>
                                {tasks.map(t => (
                                    <tr key={t} className="border-b border-slate-50">
                                        <td className="p-2 text-xs font-bold text-slate-600">{t}</td>
                                        {users.map(u => (
                                            <td key={u} className="text-center">
                                                <button onClick={() => toggle(u, t)} className="text-2xl p-1">
                                                    {data[selectedDate]?.[u]?.[t] ? 'โ' : 'โช'}
                                                </button>
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className="m-4 p-4 bg-slate-100 rounded-2xl">
                        <h2 className="text-lg font-bold mb-4">๐ ุงูุชุฑุชูุจ ุงููุจุงุดุฑ</h2>
                        {scores.map((s, idx) => (
                            <div key={s.name} className="flex justify-between p-2 border-b">
                                <span>{idx+1}. {s.name}</span>
                                <span className="font-bold">{s.count} โ</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
