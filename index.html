<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุทุจูู ุงูุนุจุงุฏุงุช ุงููุชูุงูู</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const tips = [
            "ูุงู ๏ทบ: 'ุฃุญุจ ุงูุฃุนูุงู ุฅูู ุงููู ุฃุฏูููุง ูุฅู ูู'.",
            "ูุตูุญุฉ: ุงุฌุนู ูููุณู ุฎุจูุฆุฉ ูู ุนูู ุตุงูุญ ูุง ูุนูููุง ุฅูุง ุงููู.",
            "ูุงู ๏ทบ: 'ูู ุณูู ุทุฑูููุง ููุชูุณ ููู ุนูููุง ุณูู ุงููู ูู ุจู ุทุฑูููุง ุฅูู ุงูุฌูุฉ'.",
            "ูุตูุญุฉ: ุงูุตูุงุฉ ุนูู ุงููุจู ๏ทบ ุชูุชุญ ุงูุฃุจูุงุจ ุงููุบููุฉ.",
            "ูุงู ๏ทบ: 'ุงูุฏุงู ุนูู ุงูุฎูุฑ ููุงุนูู'.",
            "ูุตูุญุฉ: ุฌุฏุฏ ููุชู ูู ูู ุนุจุงุฏุฉ ููุฒุฏุงุฏ ุฃุฌุฑู.",
            "ูุงู ๏ทบ: 'ูููุชุงู ุฎูููุชุงู ุนูู ุงููุณุงูุ ุซูููุชุงู ูู ุงูููุฒุงู: ุณุจุญุงู ุงููู ูุจุญูุฏูุ ุณุจุญุงู ุงููู ุงูุนุธูู'.",
            "ูุตูุญุฉ: ุญุงูุธ ุนูู ุตูุงุฉ ุงูุถุญู ูุฅููุง ุตูุงุฉ ุงูุฃูุงุจูู."
        ];

        function App() {
            const users = ['ูุญูุฏ', 'ุดููุงุก', 'ุฃุญูุฏ', 'ูุงุณูู'];
            const getTodayStr = () => new Date().toISOString().split('T')[0];
            const [selectedDate, setSelectedDate] = useState(getTodayStr());
            const [data, setData] = useState(() => JSON.parse(localStorage.getItem('worship_db_v3') || '{}'));

            useEffect(() => {
                localStorage.setItem('worship_db_v3', JSON.stringify(data));
            }, [data]);

            const isFriday = new Date(selectedDate).getDay() === 5;

            const tasks = useMemo(() => {
                let t = [
                    "ุณูุฉ ุงููุฌุฑ", "ุตูุงุฉ ุงููุฌุฑ", "ุฃุฐูุงุฑ ุงูุตุจุงุญ", "ุงูุถุญู",
                    "ูค ุฑูุนุงุช ูุจู ุงูุธูุฑ", isFriday ? "ุตูุงุฉ ุงูุฌูุนุฉ" : "ุตูุงุฉ ุงูุธูุฑ", "ุฑูุนุชุงู ุจุนุฏ ุงูุธูุฑ",
                    "ุตูุงุฉ ุงูุนุตุฑ", "ุฃุฐูุงุฑ ุงููุณุงุก", "ุตูุงุฉ ุงููุบุฑุจ", "ุฑูุนุชุงู ุจุนุฏ ุงููุบุฑุจ",
                    "ุตูุงุฉ ุงูุนุดุงุก", "ุฑูุนุชุงู ุจุนุฏ ุงูุนุดุงุก", "ุณูุฑุฉ ุงูููู", "ุงูุดูุน ูุงููุชุฑ", 
                    "ุงูููุงู", "ุงููุฑุฏ ุงููุฑุขูู", "ุฃุฐูุงุฑ ุงูููู"
                ];
                if (isFriday) t.splice(4, 0, "ุณูุฑุฉ ุงูููู ๐");
                return t;
            }, [isFriday]);

            const toggle = (user, task) => {
                const newData = { ...data };
                if (!newData[selectedDate]) newData[selectedDate] = {};
                if (!newData[selectedDate][user]) newData[selectedDate][user] = {};
                newData[selectedDate][user][task] = !newData[selectedDate][user][task];
                setData(newData);
            };

            // ุญุณุงุจ ุงูุฅูุฌุงุฒุงุช
            const scores = users.map(user => {
                const completed = data[selectedDate]?.[user] ? Object.values(data[selectedDate][user]).filter(Boolean).length : 0;
                return { name: user, count: completed };
            }).sort((a, b) => b.count - a.count);

            const dailyTip = tips[new Date(selectedDate).getDate() % tips.length];

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col border-x border-slate-200 pb-10">
                    {/* ุงูููุฏุฑ */}
                    <div className={`${isFriday ? 'bg-emerald-700' : 'bg-indigo-700'} p-5 text-white`}>
                        <h1 className="text-xl font-bold text-center mb-4 font-serif">ุญุตุงุฏ ุงูุนุจุงุฏุงุช</h1>
                        <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="w-full text-gray-900 p-2 rounded-lg font-bold mb-2" />
                        <button onClick={() => setSelectedDate(getTodayStr())} className="w-full py-1 text-xs bg-white/20 rounded-lg">ุงูุนูุฏุฉ ููููู</button>
                    </div>

                    {/* ูุตูุญุฉ ุงูููู */}
                    <div className="m-4 p-4 bg-amber-50 border-r-4 border-amber-400 rounded-l-lg shadow-sm">
                        <p className="text-sm italic text-amber-900 font-medium">โจ {dailyTip}</p>
                    </div>

                    {/* ุฌุฏูู ุงูุนุจุงุฏุงุช */}
                    <div className="px-2">
                        <table className="w-full text-right">
                            <thead>
                                <tr className="border-b text-[10px] text-slate-400 uppercase">
                                    <th className="p-2">ุงูุนุจุงุฏุฉ</th>
                                    {users.map(u => <th key={u} className="text-center">{u}</th>)}
                                </tr>
                            </thead>
                            <tbody>
                                {tasks.map(t => (
                                    <tr key={t} className="border-b border-slate-50 hover:bg-slate-50">
                                        <td className="p-2 text-xs font-bold text-slate-600">{t}</td>
                                        {users.map(u => (
                                            <td key={u} className="text-center">
                                                <button onClick={() => toggle(u, t)} className="text-xl p-1 transition-transform active:scale-150">
                                                    {data[selectedDate]?.[u]?.[t] ? 'โ' : 'โช'}
                                                </button>
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* ูุงุฆูุฉ ุงูุฅูุฌุงุฒุงุช */}
                    <div className="m-4 mt-8">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
                            ๐ ุชุฑุชูุจ ุงูุฅูุฌุงุฒ ุงููููู
                        </h2>
                        <div className="space-y-3">
                            {scores.map((s, index) => (
                                <div key={s.name} className={`flex items-center justify-between p-3 rounded-xl border ${index === 0 ? 'bg-emerald-50 border-emerald-200 ring-2 ring-emerald-100' : 'bg-white border-slate-100'}`}>
                                    <div className="flex items-center gap-3">
                                        <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${index === 0 ? 'bg-emerald-500 text-white' : 'bg-slate-200'}`}>
                                            {index + 1}
                                        </span>
                                        <span className="font-bold text-slate-700">{s.name}</span>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <span className="text-sm font-medium text-slate-500">{s.count} ุนุจุงุฏุฉ</span>
                                        {index === 0 && s.count > 0 && (
                                            <span className="text-[10px] bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full animate-bounce">ูุฌู ุงูููู ๐</span>
                                        )}
                                    </div>
                                </tr>
                            ))}
                        </div>
                        {scores[0].count > 0 && (
                            <p className="mt-4 text-center text-sm font-bold text-emerald-600 italic">
                                "ูุง ุดุงุก ุงููู ูุง {scores[0].name}ุ ุงุณุชูุฑ ูู ุงูุชูุฏู ูููุน ุงููู ุจู!"
                            </p>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
